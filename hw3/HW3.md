# CS292C-HW3: A Taste of ZK Verifications

This task will get you familiar with using Picus to perform Zero-Knowledge (ZK) verification tasks. If you missed the previous ZK related lectures, please find their recordings on the course slack channel and get yourself familiar with relevant concepts and notions. This homework assumes that you are familiar with them already, and we will play with simple verification tasks in ZK domain.

To get started with, please clone Picus from [https://github.com/chyanju/Picus](https://github.com/chyanju/Picus), and install all dependencies according to its README. Then follow the "Quick-Start Guides" to pre-process the Ecne benchmarks. You can find the Ecne benchmarks in `benchmarks/ecne/`. When you are done with the setup, you should be able to run a simple verification command as shown in the guides:

```bash
racket ./run-ecne-equivalence.rkt --cname AND@gates
```

This will output the following message (or similar message) if your environment configuration is correct:

```bash
# using solver: #<z3>
# using: AND@gates
# processing r1cs...
  # number of wires: 4
  # number of constraints: 1
  # field size (how many bytes): 32
  # number of constraints: 1
# processing circuit...
  # parsing piece 0...
  # interpreting piece 0...
  # parsing piece 1...
  # interpreting piece 1...
  # vc: #(struct:vc #t (bveq main.out$6 (bvmul main.a$4 main.b$5)))
  # inputs: #hash((main.a . main.a$4) (main.b . main.b$5))
  # outputs: #hash((main.out . main.out$6))
  # intermediates: #hash()
# connecting symbols...
  # [input, eq] key=main.b, r1cs=r1cs.x$3, circom=main.b$5
  # [output, neq] key=main.out, r1cs=r1cs.x$1, circom=main.out$6
  # [input, eq] key=main.a, r1cs=r1cs.x$2, circom=main.a$4
# solving equivalence...
  # no counterexample: verified
```

Then you can start solving the following problems.

#### Task 1 (30%): Reading R1CS Constraints

The Picus tool has a builtin library for processing R1CS constraints generated by circom. Those constraints are stored in the `*.r1cs` files. The Picus repo has an example script showing you how to print those constraints into human readable format. 

1. (15%) Please try out the `test-read-r1cs.rkt` by just running it directly and print out the human readable constraint of the Ecne benchmark `AND@gates`. Attach the script output here.
2. (15%) Based on your understanding of the output of `test-read-r1cs.rkt` on `AND@gates`, what do `x1`, `x2` and `x3` corresponding to in the original `AND@gates` circom file (and the file/template it's using)? 

#### Task 2 (30%): Uniqueness Verification

The Picus tool also has an example script for testing uniqueness of an R1CS constraint system. The uniqueness property that Picus is checking is that, given a certain set of fixed variables and a set of R1CS equations, are the equation solutions unique for another set of variables.

1. (10%) Please try out the `test-uniqueness.rkt` by just running it directly. Modify its source code to read in and check for the uniqueness property of the `AND@gates` R1CS. Attach the script output here.
2. (10%) Read the implementation code of  `test-uniqueness.rkt` carefully. Using the `AND@gates` constraint system as an example, please write down here all the verification conditions that the script has explicitly (by calling the `assert` construct) and implicitly (maintained by rosette) generated.
3. (10%) Following the previous question, based on your understanding of the code, for the variables in the R1CS of `AND@gates`, which variables are fixed, and what variables are the ones that Picus queries uniqueness on? Please write them down here.

#### Task 3 (40%): Equivalence Verification

Finally, the Picus can also check for equivalence between a circom program (a circuit) and its compiled R1CS. This is basically a translation verification problem. The `run-ecne-equivalence.rkt` is the entrance of equivalence checking.

1. (10%) Please try to use the above script to verify the `MultiAND@gates` benchmark. Attach the script output here.
2. (10%) What's the verification result of `MultiAND@gates`? Is the original circom program equivalent to its compiled R1CS? Briefly explain the result here, including whether they are equivalent or not, and the verification conditions generated.
3. (20%) The `MultiAND@gates` is using a template called `MultiAND(n)` from the circomlib (see `benchmarks/circomlib/gates.circom`). Please modify the implementation of the `MultiAND(n)` template, so that the uniqueness verification of `MultiAND@gates` fails. Please attach the modified template here and briefly explain why this makes the uniqueness verification fails.

## Notes and Hints

1. Picus is currently under development and is not scalable on all benchmarks, but all the benchmarks involved in the above tasks are simple enough for Picus to reason on and terminate. So if you encounter any situations that you need to wait for the script to terminate for a long time, there's probably something wrong. Read the task description carefully or post a question on the slack channel for clarafication.
2. Picus is an open-sourced project. Any comments, suggestions are welcomed.
